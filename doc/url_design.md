# kifupのページ・URL設計

## URL設計

### URLと用途

|URL|説明|
|---|---|
|`/api/*`|APIリクエスト|
|`/swagger/*`|SwaggerUIへのアクセス|
|`/file/private/*`|非公開リソース（棋譜）の取得|
|`/file/private-manage/*`|非公開リソース（DB、棋譜）の管理|
|`/file/public/*`|公開リソース（OGP画像、アカウントアイコン）の取得|
|`/file/public-manage/*`|公開リソース（OGP画像、アカウントアイコン）の管理|
|その他|Webページへのアクセス|

### S3のパス構成

```text
s3-kifup/
  ├── private/                             # ダウンロードにも認証が必要なファイル
  │   ├ database/                          # DBファイル(SQLite)
  │   │   ├ current.db                     # 現在使用中のDB
  │   │   └ {YYYYMM}/{YYYYMMDD_HHMMSS}.db  # バックアップ
  │   └ kifu/{accountID}/{kifuID}.{format} # kifu
  ├── public/                              # 認証なしでダウンロードが可能なファイル
  │   ├ icon/{accountID}                   # アカウントアイコン
  │   └ ogp/kifu/{kifuID}                  # 棋譜ページのOGP画像
  └── frontend/                            # フロントエンド
```

### API一覧

- アカウント管理
  - POST /api/account/verify-mail ... 認証メールの送信
  - POST /api/account/verify-code ... 認証コードの検証
  - POST /api/account ... アカウント新規作成
  - GET /api/account ... アカウント情報取得
  - DELETE /api/account ... アカウント削除
  - POST /api/account/reset-password ... パスワードリセット
  - PUT /api/account/password ... パスワード変更
  - PUT /api/account/info ... アカウント情報変更
  - GET /api/account/{accountID} ... アカウント情報取得（他者）
- セッション管理
  - POST /api/session/login ... ログイン
  - POST /api/session/refresh ... セッショントークンの更新
  - ※ログアウトは、frontendでトークン削除する
- 棋譜検索
  - GET /api/kifu ... 公開棋譜を検索
  - GET /api/kifu?owner=me ... 自身の棋譜一覧を取得
- 棋譜管理
  - POST /api/kifu ... 棋譜の新規作成
  - GET /api/kifu/{kifuID} ... 棋譜の詳細取得
  - PUT /api/kifu/{kifuID} ... 棋譜情報の編集
  - PUT /api/kifu/{kifuID}/moves ... 棋譜の指し手の編集
  - DELETE /api/kifu/{kifuID} ... 棋譜の削除
  - GET /api/kifu/download ... 棋譜のダウンロードURL取得
- いいね/感想コメント
  - （未設計）
- 通知
  - （未設計）

### ページ一覧

- ビジター用のページ
  - トップ（/）
  - 棋譜検索（/kifu/search）
  - 棋譜閲覧（/kifu/view）
  - アカウント詳細（/account）
- アカウント用のページ
  - ホーム（/home）
  - 棋譜検索（/kifu/search）
  - 棋譜閲覧（/kifu/view）
  - 棋譜新規作成（/kifu/new）
  - 棋譜編集（/kifu/edit）
  - アカウント詳細（/account）
  - 設定（/settings）

## 各ページの要素と機能

### 共通要素

- ヘッダー
  - ロゴ/サイト名
- フッター
  - サイト情報
- ナビゲーション（ビジター用）
  - ログイン　※トップページと同じ
  - 棋譜検索
- ナビゲーション（アカウント用）
  - ホーム
  - 新規作成
  - 棋譜検索
  - 設定
  - ログアウトボタン

### 1. トップページ（/）

- ログインフォーム
- アカウント登録フォーム
- パスワードリセットフォーム
- ガイダンス説明

### 2. ホームページ（/home）

- アカウント向けの通知　※他ユーザーからのいいね／コメントなど
- 自分の棋譜リスト　※未公開のものを含む
  - タイトル
  - 対局日
  - 対局者
  - タグ
  - 公開ステータス
  - いいね数
  - コメント数
  - 選択時のポップアップ
    - 詳細ページへ
    - 編集ページへ
    - 公開／非公開ボタン
    - 削除ボタン

### 3. 棋譜検索（/kifu/search）

- 棋譜検索フォーム
  - キーワード
  - 投稿アカウント
  - タグ
  - 対局日時
- 公開棋譜リスト
  - タイトル
  - 対局日時
  - 対局者
  - タグ
  - いいね数
  - 感想コメント数

### 4. 棋譜閲覧（/kifu/view）

- 棋譜情報
  - タイトル
  - 対局日時
  - 対局者
  - タグ
- 棋譜再生ビュー
  - 指し手リスト
  - 局面表示
  - 局面コメント　※非表示可能
  - 操作ボタン
    - 最初／前の手／次の手／最後
    - 自動再生／リアルタイム再生
    - 局面図ダウンロードボタン
    - 棋譜ダウンロードボタン
- 編集ボタン（所有者のみ）
- いいねボタン
- 感想コメントフォーム
- 感想コメント一覧

### 5. 棋譜新規作成（/kifu/new）

- アップロードフォーム
- テキストボックス
- 初期局面エディタ
  - 局面表示　※駒の操作で編集可能
  - 駒箱表示　※駒の操作で編集可能
- 初期局面から作成ボタン

### 6. 棋譜編集（/kifu/edit）

- 棋譜情報
  - タイトル
  - 対局日時
  - 対局者
  - タグ
- 棋譜エディタ
  - 局面図用タイトル　※非表示可能
  - 指し手リスト
  - 局面表示　※駒の操作で入力可能
  - 局面コメント　※非表示可能
  - 操作ボタン
    - 最初／前の手／次の手／最後
    - 局面図ダウンロードボタン
    - 棋譜ダウンロードボタン
- 公開ステータス
- 編集完了ボタン

### 7. アカウント詳細（/account）

- プロフィール
  - 名前
  - アイコン
  - 自己紹介
- 公開棋譜リスト
  - タイトル
  - 対局日時
  - 対局者
  - タグ
  - いいね数
  - 感想コメント数

### 8. 設定（/settings）

- アカウント設定
  - メールアドレス表示
  - 通知設定
- プロフィール設定
  - 名前
  - アイコン
  - 自己紹介

### 補足説明

- ユーザーは、アカウント登録していない「ビジター」と、登録済みの「アカウント」の2種類
- ビジターは棋譜を閲覧のみ可能、アカウントは棋譜を作成・保存できる
- 棋譜の作成方法は、テキストデータをアップロードする方法と、指定した初期局面から作成する方法とがある
- 棋譜を作成すると、非公開状態で保存されて編集画面に遷移する
- 局面コメントは棋譜の所有者が編集可能なもので、棋譜データの一部
- 編集ページでは棋譜を編集しながら局面図を生成したり、クリエイティブな用途として使えるようにする
- ソーシャル機能（いいね・感想コメント）は、開発の優先度が低いため後から機能追加する
- 開発環境はローカルで、AWS上にステージング環境と本番環境を構築する
